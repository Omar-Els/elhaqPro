var D=Object.defineProperty,k=Object.defineProperties;var w=Object.getOwnPropertyDescriptors;var C=Object.getOwnPropertySymbols;var F=Object.prototype.hasOwnProperty,y=Object.prototype.propertyIsEnumerable;var A=(a,n,t)=>n in a?D(a,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[n]=t,b=(a,n)=>{for(var t in n||(n={}))F.call(n,t)&&A(a,t,n[t]);if(C)for(var t of C(n))y.call(n,t)&&A(a,t,n[t]);return a},N=(a,n)=>k(a,w(n));import{j as s}from"./ui-DdfHXWzg.js";import{r as m}from"./router-Bz2IGiOt.js";import{u as E,e as g}from"./redux-CWL_9H02.js";import{H as B,I as O,J as T,K as L,L as $,M as H,N as J,O as K,P as M}from"./index-COkUExVb.js";import"./vendor-BDC5HmX-.js";const P=({initiative:a=null,onComplete:n,isEditing:t=!1})=>{const[l,h]=m.useState({name:"",date:new Date().toISOString().split("T")[0],description:"",beneficiaries:[],totalAmount:0}),[r,u]=m.useState({}),[d,p]=m.useState([]),x=E(),f=g(B);m.useEffect(()=>{a&&(h(N(b({},a),{date:a.date||new Date().toISOString().split("T")[0]})),a.beneficiaries&&a.beneficiaries.length>0&&p(a.beneficiaries.map(e=>e.id)))},[a]);const v=()=>{const e={};return l.name.trim()||(e.name="اسم المبادرة مطلوب"),l.date||(e.date="تاريخ المبادرة مطلوب"),l.description.trim()||(e.description="وصف المبادرة مطلوب"),u(e),Object.keys(e).length===0},j=e=>{const{name:i,value:c}=e.target;h(o=>N(b({},o),{[i]:c})),r[i]&&u(o=>N(b({},o),{[i]:void 0}))},I=e=>{p(i=>i.includes(e)?i.filter(c=>c!==e):[...i,e])},S=e=>{if(e.preventDefault(),!v())return;const i=f.filter(o=>d.includes(o.id)),c=N(b({},l),{beneficiaries:i});x(t?O(c):T(c)),n()};return s.jsxs("div",{className:"initiative-form-container",children:[s.jsx("h2",{children:t?"تعديل المبادرة":"إضافة مبادرة جديدة"}),s.jsxs("form",{onSubmit:S,children:[s.jsxs("div",{className:"form-group",children:[s.jsx("label",{htmlFor:"name",children:"اسم المبادرة"}),s.jsx("input",{type:"text",id:"name",name:"name",value:l.name,onChange:j,className:r.name?"error":""}),r.name&&s.jsx("div",{className:"error-message",children:r.name})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{htmlFor:"date",children:"تاريخ المبادرة"}),s.jsx("input",{type:"date",id:"date",name:"date",value:l.date,onChange:j,className:r.date?"error":""}),r.date&&s.jsx("div",{className:"error-message",children:r.date})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{htmlFor:"description",children:"وصف المبادرة"}),s.jsx("textarea",{id:"description",name:"description",value:l.description,onChange:j,rows:"4",className:r.description?"error":""}),r.description&&s.jsx("div",{className:"error-message",children:r.description})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{htmlFor:"beneficiaries-selection",children:"المستفيدون"}),s.jsx("div",{id:"beneficiaries-selection",className:"beneficiaries-selection",children:f.length>0?s.jsx("div",{className:"beneficiaries-list",children:f.map(e=>s.jsxs("div",{className:"beneficiary-checkbox",children:[s.jsx("input",{type:"checkbox",id:`beneficiary-${e.id}`,checked:d.includes(e.id),onChange:()=>I(e.id)}),s.jsxs("label",{htmlFor:`beneficiary-${e.id}`,children:[e.name," - ",e.nationalId]})]},e.id))}):s.jsx("p",{className:"no-beneficiaries",children:"لا يوجد مستفيدين مسجلين. يرجى إضافة مستفيدين أولاً."})}),s.jsxs("div",{className:"selected-count",children:["تم اختيار ",d.length," مستفيد"]})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{htmlFor:"totalAmount",children:"إجمالي الدعم"}),s.jsx("input",{type:"number",id:"totalAmount",name:"totalAmount",value:l.totalAmount,onChange:j,min:"0",step:"0.01"})]}),s.jsxs("div",{className:"form-actions",children:[s.jsx("button",{type:"button",className:"btn btn-secondary",onClick:n,children:"إلغاء"}),s.jsx("button",{type:"submit",className:"btn btn-primary",children:t?"تحديث المبادرة":"إضافة المبادرة"})]})]})]})},V=()=>{const[a,n]=m.useState(!1),[t,l]=m.useState(null),[h,r]=m.useState(null),u=E(),d=g(e=>e.initiatives?L(e):[]),p=g(e=>e.initiatives?$(e):!1),x=g(e=>e.initiatives?H(e):null);console.log("Initiatives:",d),console.log("Loading:",p),console.log("Error:",x),m.useEffect(()=>{u(J())},[u]);const f=()=>{l(null),n(!0)},v=e=>{l(e),n(!0)},j=e=>{window.confirm("هل أنت متأكد من حذف هذه المبادرة؟")&&u(K(e))},I=e=>{var c;const i=[{"اسم المبادرة":e.name,التاريخ:e.date,الوصف:e.description,"عدد المستفيدين":((c=e.beneficiaries)==null?void 0:c.length)||0,"إجمالي الدعم":e.totalAmount||0}];M(i,`initiative-${e.id}`)},S=e=>{r(h===e?null:e)};return s.jsxs("div",{className:"initiatives-container",children:[s.jsxs("div",{className:"page-header",children:[s.jsx("h1",{children:"المبادرات الموسمية"}),s.jsx("button",{className:"btn btn-primary",onClick:f,children:"إضافة مبادرة جديدة"})]}),a&&s.jsx(P,{initiative:t,isEditing:!!t,onComplete:()=>{n(!1),l(null)}}),x&&s.jsx("div",{className:"error-message",children:x}),p?s.jsx("div",{className:"loading-message",children:"جاري تحميل البيانات..."}):s.jsx("div",{className:"initiatives-grid",children:d&&d.length>0?d.map(e=>{var i,c;return s.jsxs("div",{className:"initiative-card card",children:[s.jsx("h3",{children:e.name}),s.jsxs("p",{className:"initiative-date",children:["التاريخ: ",e.date]}),s.jsx("p",{className:"initiative-description",children:e.description}),s.jsxs("div",{className:"initiative-stats",children:[s.jsxs("div",{className:"stat",children:[s.jsx("span",{className:"stat-label",children:"عدد المستفيدين:"}),s.jsx("span",{className:"stat-value",children:((i=e.beneficiaries)==null?void 0:i.length)||0})]}),s.jsxs("div",{className:"stat",children:[s.jsx("span",{className:"stat-label",children:"إجمالي الدعم:"}),s.jsxs("span",{className:"stat-value",children:[e.totalAmount||0," جنيه"]})]})]}),h===e.id&&s.jsxs("div",{className:"initiative-details",children:[s.jsx("h4",{children:"المستفيدون:"}),((c=e.beneficiaries)==null?void 0:c.length)>0?s.jsx("ul",{className:"beneficiaries-list",children:e.beneficiaries.map(o=>s.jsx("li",{children:o.name},o.id))}):s.jsx("p",{children:"لا يوجد مستفيدين مسجلين في هذه المبادرة"})]}),s.jsxs("div",{className:"card-actions",children:[s.jsx("button",{className:"btn btn-secondary",onClick:()=>S(e.id),children:h===e.id?"إخفاء التفاصيل":"عرض التفاصيل"}),s.jsx("button",{className:"btn btn-primary",onClick:()=>v(e),children:"تعديل"}),s.jsx("button",{className:"btn btn-danger",onClick:()=>j(e.id),children:"حذف"}),s.jsx("button",{className:"btn btn-info",onClick:()=>I(e),children:"تصدير إلى Excel"})]})]},e.id)}):s.jsx("div",{className:"no-results",children:s.jsx("p",{children:"لا توجد مبادرات حال"})})})]})};export{V as default};
