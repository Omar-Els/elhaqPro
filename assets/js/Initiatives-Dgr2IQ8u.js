import{j as s}from"./ui-4y8eivj0.js";import{r as d}from"./router-CLq98pCg.js";import{u as I,e as b}from"./redux-Bcoi-VAn.js";import{H as S,I as C,J as A,K as E,L as D,M as k,N as w,O as F,P as y}from"./index-B-68B3Uo.js";import"./vendor-CWc6w16D.js";const B=({initiative:l=null,onComplete:o,isEditing:m=!1})=>{const[n,h]=d.useState({name:"",date:new Date().toISOString().split("T")[0],description:"",beneficiaries:[],totalAmount:0}),[t,u]=d.useState({}),[r,p]=d.useState([]),x=I(),f=b(S);d.useEffect(()=>{l&&(h({...l,date:l.date||new Date().toISOString().split("T")[0]}),l.beneficiaries&&l.beneficiaries.length>0&&p(l.beneficiaries.map(e=>e.id)))},[l]);const N=()=>{const e={};return n.name.trim()||(e.name="اسم المبادرة مطلوب"),n.date||(e.date="تاريخ المبادرة مطلوب"),n.description.trim()||(e.description="وصف المبادرة مطلوب"),u(e),Object.keys(e).length===0},j=e=>{const{name:a,value:i}=e.target;h(c=>({...c,[a]:i})),t[a]&&u(c=>({...c,[a]:void 0}))},g=e=>{p(a=>a.includes(e)?a.filter(i=>i!==e):[...a,e])},v=e=>{if(e.preventDefault(),!N())return;const a=f.filter(c=>r.includes(c.id)),i={...n,beneficiaries:a};x(m?C(i):A(i)),o()};return s.jsxs("div",{className:"initiative-form-container",children:[s.jsx("h2",{children:m?"تعديل المبادرة":"إضافة مبادرة جديدة"}),s.jsxs("form",{onSubmit:v,children:[s.jsxs("div",{className:"form-group",children:[s.jsx("label",{htmlFor:"name",children:"اسم المبادرة"}),s.jsx("input",{type:"text",id:"name",name:"name",value:n.name,onChange:j,className:t.name?"error":""}),t.name&&s.jsx("div",{className:"error-message",children:t.name})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{htmlFor:"date",children:"تاريخ المبادرة"}),s.jsx("input",{type:"date",id:"date",name:"date",value:n.date,onChange:j,className:t.date?"error":""}),t.date&&s.jsx("div",{className:"error-message",children:t.date})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{htmlFor:"description",children:"وصف المبادرة"}),s.jsx("textarea",{id:"description",name:"description",value:n.description,onChange:j,rows:"4",className:t.description?"error":""}),t.description&&s.jsx("div",{className:"error-message",children:t.description})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{htmlFor:"beneficiaries-selection",children:"المستفيدون"}),s.jsx("div",{id:"beneficiaries-selection",className:"beneficiaries-selection",children:f.length>0?s.jsx("div",{className:"beneficiaries-list",children:f.map(e=>s.jsxs("div",{className:"beneficiary-checkbox",children:[s.jsx("input",{type:"checkbox",id:`beneficiary-${e.id}`,checked:r.includes(e.id),onChange:()=>g(e.id)}),s.jsxs("label",{htmlFor:`beneficiary-${e.id}`,children:[e.name," - ",e.nationalId]})]},e.id))}):s.jsx("p",{className:"no-beneficiaries",children:"لا يوجد مستفيدين مسجلين. يرجى إضافة مستفيدين أولاً."})}),s.jsxs("div",{className:"selected-count",children:["تم اختيار ",r.length," مستفيد"]})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{htmlFor:"totalAmount",children:"إجمالي الدعم"}),s.jsx("input",{type:"number",id:"totalAmount",name:"totalAmount",value:n.totalAmount,onChange:j,min:"0",step:"0.01"})]}),s.jsxs("div",{className:"form-actions",children:[s.jsx("button",{type:"button",className:"btn btn-secondary",onClick:o,children:"إلغاء"}),s.jsx("button",{type:"submit",className:"btn btn-primary",children:m?"تحديث المبادرة":"إضافة المبادرة"})]})]})]})},J=()=>{const[l,o]=d.useState(!1),[m,n]=d.useState(null),[h,t]=d.useState(null),u=I(),r=b(e=>e.initiatives?E(e):[]),p=b(e=>e.initiatives?D(e):!1),x=b(e=>e.initiatives?k(e):null);console.log("Initiatives:",r),console.log("Loading:",p),console.log("Error:",x),d.useEffect(()=>{u(w())},[u]);const f=()=>{n(null),o(!0)},N=e=>{n(e),o(!0)},j=e=>{window.confirm("هل أنت متأكد من حذف هذه المبادرة؟")&&u(F(e))},g=e=>{var i;const a=[{"اسم المبادرة":e.name,التاريخ:e.date,الوصف:e.description,"عدد المستفيدين":((i=e.beneficiaries)==null?void 0:i.length)||0,"إجمالي الدعم":e.totalAmount||0}];y(a,`initiative-${e.id}`)},v=e=>{t(h===e?null:e)};return s.jsxs("div",{className:"initiatives-container",children:[s.jsxs("div",{className:"page-header",children:[s.jsx("h1",{children:"المبادرات الموسمية"}),s.jsx("button",{className:"btn btn-primary",onClick:f,children:"إضافة مبادرة جديدة"})]}),l&&s.jsx(B,{initiative:m,isEditing:!!m,onComplete:()=>{o(!1),n(null)}}),x&&s.jsx("div",{className:"error-message",children:x}),p?s.jsx("div",{className:"loading-message",children:"جاري تحميل البيانات..."}):s.jsx("div",{className:"initiatives-grid",children:r&&r.length>0?r.map(e=>{var a,i;return s.jsxs("div",{className:"initiative-card card",children:[s.jsx("h3",{children:e.name}),s.jsxs("p",{className:"initiative-date",children:["التاريخ: ",e.date]}),s.jsx("p",{className:"initiative-description",children:e.description}),s.jsxs("div",{className:"initiative-stats",children:[s.jsxs("div",{className:"stat",children:[s.jsx("span",{className:"stat-label",children:"عدد المستفيدين:"}),s.jsx("span",{className:"stat-value",children:((a=e.beneficiaries)==null?void 0:a.length)||0})]}),s.jsxs("div",{className:"stat",children:[s.jsx("span",{className:"stat-label",children:"إجمالي الدعم:"}),s.jsxs("span",{className:"stat-value",children:[e.totalAmount||0," جنيه"]})]})]}),h===e.id&&s.jsxs("div",{className:"initiative-details",children:[s.jsx("h4",{children:"المستفيدون:"}),((i=e.beneficiaries)==null?void 0:i.length)>0?s.jsx("ul",{className:"beneficiaries-list",children:e.beneficiaries.map(c=>s.jsx("li",{children:c.name},c.id))}):s.jsx("p",{children:"لا يوجد مستفيدين مسجلين في هذه المبادرة"})]}),s.jsxs("div",{className:"card-actions",children:[s.jsx("button",{className:"btn btn-secondary",onClick:()=>v(e.id),children:h===e.id?"إخفاء التفاصيل":"عرض التفاصيل"}),s.jsx("button",{className:"btn btn-primary",onClick:()=>N(e),children:"تعديل"}),s.jsx("button",{className:"btn btn-danger",onClick:()=>j(e.id),children:"حذف"}),s.jsx("button",{className:"btn btn-info",onClick:()=>g(e),children:"تصدير إلى Excel"})]})]},e.id)}):s.jsx("div",{className:"no-results",children:s.jsx("p",{children:"لا توجد مبادرات حال"})})})]})};export{J as default};
