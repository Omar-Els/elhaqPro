var R=Object.defineProperty,Q=Object.defineProperties;var V=Object.getOwnPropertyDescriptors;var $=Object.getOwnPropertySymbols;var X=Object.prototype.hasOwnProperty,Y=Object.prototype.propertyIsEnumerable;var q=(s,i,o)=>i in s?R(s,i,{enumerable:!0,configurable:!0,writable:!0,value:o}):s[i]=o,d=(s,i)=>{for(var o in i||(i={}))X.call(i,o)&&q(s,o,i[o]);if($)for(var o of $(i))Y.call(i,o)&&q(s,o,i[o]);return s},m=(s,i)=>Q(s,V(i));import{j as e,m as l,A as T}from"./ui-DdfHXWzg.js";import{r as h}from"./router-Bz2IGiOt.js";import{u as Z,e as y}from"./redux-CWL_9H02.js";import{Q as _,R as z,S as G,H as J,T as v,U as k,V as K,W as ee,X as ae,Y as se,Z as ie,_ as te,$ as A,a0 as ne}from"./index-COkUExVb.js";import"./vendor-BDC5HmX-.js";const he=()=>{const s=Z(),[i,o]=h.useState(!1),[x,D]=h.useState(!1),[r,B]=h.useState({date:new Date().toISOString().split("T")[0],amount:"",type:"expense",description:"",beneficiaries:[]}),[t,p]=h.useState({amount:"",method:"cash",description:"",date:new Date().toISOString().split("T")[0]}),g=y(_),N=y(z);y(G);const F=y(J),[u,C]=h.useState([]),[j,E]=h.useState(!1);h.useEffect(()=>{s(v())},[g,s]);const S=()=>{o(!i),x&&D(!1),i||(B({date:new Date().toISOString().split("T")[0],amount:"",type:"expense",description:"",beneficiaries:[]}),C([]))},w=()=>{D(!x),i&&o(!1),x||p({amount:"",method:"cash",description:"",date:new Date().toISOString().split("T")[0]})},b=a=>{const{name:n,value:c}=a.target;p(m(d({},t),{[n]:c}))},f=a=>{const{name:n,value:c}=a.target;B(m(d({},r),{[n]:c}))},H=()=>{E(!j)},I=a=>{u.includes(a)?C(u.filter(n=>n!==a)):C([...u,a])},O=a=>{window.confirm("هل أنت متأكد من حذف هذه المعاملة؟")&&s(ne(a)).unwrap().then(()=>{console.log("تم حذف المعاملة بنجاح"),s(v())}).catch(n=>{console.error("خطأ في حذف المعاملة:",n)})},P=a=>{a.preventDefault();const n=m(d({},r),{amount:parseFloat(r.amount),beneficiaries:u.map(c=>{const U=F.find(M=>M.id===c);return{id:U.id,name:U.name}})});s(A(n)).unwrap().then(()=>{console.log("تمت إضافة المعاملة بنجاح"),s(v()),S()}).catch(c=>{console.error("خطأ في إضافة المعاملة:",c)})},W=a=>{a.preventDefault();const n={date:t.date,amount:parseFloat(t.amount),type:"income",description:`توب أب (${L(t.method)}): ${t.description}`,beneficiaries:[]};s(A(n)).unwrap().then(()=>{console.log("تم إضافة التوب أب بنجاح"),s(v()),w()}).catch(c=>{console.error("خطأ في إضافة التوب أب:",c)})},L=a=>{switch(a){case"cash":return"نقدي";case"card":return"بطاقة ائتمان";case"bank":return"تحويل بنكي";case"donation":return"تبرع";default:return a}};return e.jsxs(l.div,{className:"finance-container",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h1",{children:"المالية"}),e.jsxs("div",{className:"header-actions",children:[e.jsx(l.button,{className:"btn btn-success",onClick:w,whileHover:{scale:1.05},whileTap:{scale:.95},children:x?"إلغاء":e.jsxs(e.Fragment,{children:[e.jsx(k,{})," توب أب"]})}),e.jsx(l.button,{className:"btn btn-primary",onClick:S,whileHover:{scale:1.05},whileTap:{scale:.95},children:i?"إلغاء":e.jsxs(e.Fragment,{children:[e.jsx(K,{})," إضافة معاملة جديدة"]})})]})]}),e.jsxs("div",{className:"finance-summary",children:[e.jsxs(l.div,{className:"summary-card income-card",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:.1},children:[e.jsx("h3",{children:"الإيرادات"}),e.jsxs("div",{className:"summary-amount",children:[N.totalIncome.toFixed(2)," جنيه مصري"]})]}),e.jsxs(l.div,{className:"summary-card expense-card",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:.2},children:[e.jsx("h3",{children:"المصروفات"}),e.jsxs("div",{className:"summary-amount",children:[N.totalExpenses.toFixed(2)," جنيه مصري"]})]}),e.jsxs(l.div,{className:"summary-card balance-card",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:.3},children:[e.jsx("h3",{children:"الرصيد"}),e.jsxs("div",{className:"summary-amount",children:[N.balance.toFixed(2)," جنيه مصري"]})]})]}),e.jsx(T,{children:x&&e.jsxs(l.div,{className:"add-form-container card top-up-form",initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},children:[e.jsx("h2",{children:"إضافة توب أب"}),e.jsxs("form",{onSubmit:W,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"topup-date",children:"التاريخ"}),e.jsx("input",{type:"date",id:"topup-date",name:"date",value:t.date,onChange:b,required:!0,autoComplete:"off","aria-label":"تاريخ التوب أب"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"topup-amount",children:"المبلغ"}),e.jsx("input",{type:"number",id:"topup-amount",name:"amount",value:t.amount,onChange:b,required:!0,min:"0",step:"0.01",autoComplete:"off","aria-label":"مبلغ التوب أب",placeholder:"أدخل المبلغ"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"topup-method",children:"طريقة الدفع"}),e.jsxs("select",{id:"topup-method",name:"method",value:t.method,onChange:b,required:!0,autoComplete:"off","aria-label":"اختر طريقة الدفع",children:[e.jsx("option",{value:"cash",children:"نقدي"}),e.jsx("option",{value:"card",children:"بطاقة ائتمان"}),e.jsx("option",{value:"bank",children:"تحويل بنكي"}),e.jsx("option",{value:"donation",children:"تبرع"})]}),e.jsxs("div",{className:"payment-method-icons",children:[e.jsxs("div",{className:`payment-method-icon ${t.method==="cash"?"active":""}`,onClick:()=>p(m(d({},t),{method:"cash"})),children:[e.jsx(k,{}),e.jsx("span",{children:"نقدي"})]}),e.jsxs("div",{className:`payment-method-icon ${t.method==="card"?"active":""}`,onClick:()=>p(m(d({},t),{method:"card"})),children:[e.jsx(ee,{}),e.jsx("span",{children:"بطاقة ائتمان"})]}),e.jsxs("div",{className:`payment-method-icon ${t.method==="bank"?"active":""}`,onClick:()=>p(m(d({},t),{method:"bank"})),children:[e.jsx(ae,{}),e.jsx("span",{children:"تحويل بنكي"})]}),e.jsxs("div",{className:`payment-method-icon ${t.method==="donation"?"active":""}`,onClick:()=>p(m(d({},t),{method:"donation"})),children:[e.jsx(se,{}),e.jsx("span",{children:"تبرع"})]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"topup-description",children:"الوصف"}),e.jsx("textarea",{id:"topup-description",name:"description",value:t.description,onChange:b,required:!0,placeholder:"أدخل وصفًا للتوب أب أو اسم المتبرع",autoComplete:"off","aria-label":"وصف التوب أب",rows:"3"})]}),e.jsxs("div",{className:"form-actions",children:[e.jsxs("button",{type:"submit",className:"btn btn-success",children:[e.jsx(k,{})," إضافة التوب أب"]}),e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:w,children:"إلغاء"})]})]})]})}),e.jsx(T,{children:i&&e.jsxs(l.div,{className:"add-form-container card",initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},children:[e.jsx("h2",{children:"إضافة معاملة جديدة"}),e.jsxs("form",{onSubmit:P,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"date",children:"التاريخ"}),e.jsx("input",{type:"date",id:"date",name:"date",value:r.date,onChange:f,required:!0,autoComplete:"off","aria-label":"تاريخ المعاملة"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"type",children:"نوع المعاملة"}),e.jsxs("select",{id:"type",name:"type",value:r.type,onChange:f,required:!0,autoComplete:"off","aria-label":"اختر نوع المعاملة",children:[e.jsx("option",{value:"income",children:"إيراد"}),e.jsx("option",{value:"expense",children:"مصروف"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"amount",children:"المبلغ"}),e.jsx("input",{type:"number",id:"amount",name:"amount",value:r.amount,onChange:f,required:!0,min:"0",step:"0.01",autoComplete:"off","aria-label":"مبلغ المعاملة",placeholder:"أدخل المبلغ"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"description",children:"الوصف"}),e.jsx("textarea",{id:"description",name:"description",value:r.description,onChange:f,required:!0,autoComplete:"off","aria-label":"وصف المعاملة",placeholder:"أدخل وصف المعاملة",rows:"3"})]}),r.type==="expense"&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"المستفيدين"}),e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:H,"aria-label":"إضافة أو إخفاء قائمة المستفيدين","aria-expanded":j,children:j?"إخفاء المستفيدين":"إضافة مستفيدين"}),e.jsx(T,{children:j&&e.jsxs(l.div,{className:"beneficiaries-selection",initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},children:[F.length>0?e.jsx("div",{className:"beneficiaries-list",children:F.map(a=>e.jsxs("div",{className:"beneficiary-checkbox",children:[e.jsx("input",{type:"checkbox",id:`beneficiary-${a.id}`,checked:u.includes(a.id),onChange:()=>I(a.id)}),e.jsx("label",{htmlFor:`beneficiary-${a.id}`,children:a.name})]},a.id))}):e.jsx("div",{className:"no-beneficiaries",children:"لا يوجد مستفيدين متاحين"}),e.jsxs("div",{className:"selected-count",children:["تم اختيار ",u.length," مستفيد"]})]})})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"submit",className:"btn btn-primary",children:"حفظ"}),e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:S,children:"إلغاء"})]})]})]})}),e.jsx("div",{className:"transactions-list",children:g.length>0?g.map(a=>e.jsxs(l.div,{className:"transaction-card card",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},children:[e.jsxs("div",{className:"transaction-header",children:[e.jsx("h3",{children:a.type==="income"?"إيراد":"مصروف"}),e.jsx("span",{className:"transaction-date",children:a.date})]}),e.jsx("div",{className:"transaction-amount",children:e.jsxs("span",{className:a.type==="income"?"income-amount":"expense-amount",children:[parseFloat(a.amount).toFixed(2)," جنيه مصري"]})}),e.jsx("div",{className:"transaction-description",children:a.description}),a.type==="expense"&&a.beneficiaries.length>0&&e.jsxs("div",{className:"transaction-beneficiaries-container",children:[e.jsxs("button",{className:"show-beneficiaries-btn",onClick:n=>{n.currentTarget.parentNode.classList.toggle("show-details")},children:["عرض المستفيدين (",a.beneficiaries.length,")"]}),e.jsx("div",{className:"transaction-beneficiaries",children:e.jsx("ul",{children:a.beneficiaries.map(n=>{const c=(parseFloat(a.amount)/a.beneficiaries.length).toFixed(2);return e.jsxs("li",{children:[e.jsx("span",{className:"beneficiary-name",children:n.name}),e.jsxs("span",{className:"beneficiary-amount",children:[c," جنيه"]})]},n.id)})})})]}),e.jsxs("div",{className:"transaction-actions",children:[e.jsx("button",{className:"btn-icon edit-btn",title:"تعديل المعاملة",onClick:()=>console.log("تعديل المعاملة",a.id),children:e.jsx(ie,{})}),e.jsx("button",{className:"btn-icon delete-btn",title:"حذف المعاملة",onClick:()=>O(a.id),children:e.jsx(te,{})})]})]},a.id)):e.jsx("div",{className:"no-transactions",children:"لا توجد معاملات مالية"})})]})};export{he as default};
